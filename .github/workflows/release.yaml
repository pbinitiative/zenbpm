name: release

on:
  push:
    tags:
      - v*

#jobs:
#  release:
#    runs-on: ubuntu-latest
#    permissions:
#      contents: write
#      packages: write
#    steps:
#      - name: checkout code
#        uses: actions/checkout@v4
#        with:
#          submodules: 'true'
#          fetch-depth: 0
#
#      - name: setup dependencies
#        uses: actions/setup-go@v4
#        with:
#          go-version-file: go.mod
#
##      - name: Configure Docker storage driver
##        run: |
##          echo '{ "storage-driver": "overlay2" }' | sudo tee /etc/docker/daemon.json
##          sudo systemctl restart docker
##          docker info | grep "Storage Driver"
#
#      - uses: docker/setup-buildx-action@v3
#        with:
#          install: true
#
#      - name: Login to GitHub Container Registry
#        uses: docker/login-action@v3
#        with:
#          registry: ghcr.io
#          username: ${{ github.actor }}
#          password: ${{ secrets.GITHUB_TOKEN }}
#
#      - name: setup release environment
#        run: |-
#          echo 'GITHUB_TOKEN=${{secrets.GITHUB_TOKEN}}' > .release-env
##          echo 'BUILDX_NO_DEFAULT_ATTESTATIONS=1' >> .release-env
##          echo 'BUILDX_NO_DEFAULT_LOAD=1' >> .release-env
##          echo 'BUILDX_METADATA_PROVENANCE=0' >> .release-env
#
#      - name: release publish
#        run: make release
#        env:
#          DOCKER_BUILDKIT: 1
#          BUILDX_NO_DEFAULT_ATTESTATIONS: 1
#     echo 'GITHUB_TOKEN=${{secrets.GORELEASER_ACCESS_TOKEN}}' > .release-env

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: setup dependencies
        uses: actions/setup-go@v4
        with:
          go-version-file: go.mod

      - name: set up QEMU
        uses: docker/setup-qemu-action@v3

      - uses: docker/setup-buildx-action@v3

      - name: setup release environment
        run: |-
          echo 'GITHUB_TOKEN=${{secrets.GITHUB_TOKEN}}' > .release-env

      - run: make release
